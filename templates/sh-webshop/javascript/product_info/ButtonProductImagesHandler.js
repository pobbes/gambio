/* ButtonProductImagesHandler.js <?php
#   --------------------------------------------------------------
#   ButtonProductImagesHandler.js 2011-11-23 gambio
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2011 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('8 1z(h,i,j){4(q)r.s(\'1z 2q\');u k=z;4(1g(h)==\'1Z\'){k=h}u l=z;4(1g(i)==\'1Z\'){l=i}u m=2r;4(20(j)!=\'2s\'){m=20(j)}u n=5,1h=0,14=1i 2t(),1j=z,1k=p,1A=0,15=\'\',1B=\'\';5.1a=8(){4(q)r.s(\'1z 1a\');5.1C();4(l){5.1D()}4(k){5.1E()}L{$(\'.16\').F(\'v\');$(\'.16\').G(\'v\',8(){4(q)r.s(\'.16 v\');4($(\'.t .w .x #Q\').H>0&&$(\'.t .w .x #Q\').7(\'1b\')!=\'1c\'){n.1d(5)}R p})}};5.1C=8(){4(q)r.s(\'1C\');u a=\'\';$(\'a.Z\').F(\'S\');$(\'a.Z\').G(\'S\',8(){4(q)r.s(\'a.Z S: \'+$(5).o(\'T\'));$(5).o(\'1l\',\'\');$(5).21(\'1F\').o(\'1l\',\'\');$(5).21(\'1F\').o(\'22\',\'\');4($(\'.t .w .x #Q\').H==0||$(\'.t .w .x #Q\').7(\'1b\')==\'1c\'){15=\'#\'+$(5).o(\'T\');4(1k==p){n.1d(5)}}R p});$(\'.Z\').F(\'V\');$(\'.Z\').G(\'V\',8(){23(1h);4($(\'.t .w .x .I\').W()==\'1m...\'){$(\'.t .w .x .I\').W(1B);n.1a()}2u(1A);15=\'\';1k=z;1A=2v(n.1n,m);a=$(5).o(\'T\');a=a.y(\'1G\',\'\');$(\'.t .w .x #24\'+a).2w(\'a\').J(\'25\');R p})};5.1n=8(){1k=p;4(15!=\'\'){4(q)r.s(\'1n(): \'+15);n.1d(15)}L{4(q)r.s(\'1n(): 2x 2y\')}};5.1d=8(a){4(1g($(a).o(\'T\'))!=\'26\'&&$(a).o(\'T\').10(\'1G\')!=-1){$(\'.t .w .x #Q\').27();$(\'a.Z\').J(\'1H\');$(a).U(\'1H\');11=$(a).o(\'T\');11=11.y(\'1G\',\'\');14[11]=1i 28();14[11].1o=$(a).o(\'E\');29=5.1I(11,$(a).o(\'2a\'));4(29==p){1h=2z(8(){n.1I(11,$(a).o(\'2a\'))},2b)}}};5.1I=8(a,b){u c=M(a),1p=z;4(14[c].2A!=z){1p=p}4(1p){23(1h);u d=\'\';4(k==p){d=\' 1J="2B: 2C;"\'}u e=14[c].1o;e=e.2D(e.10(\'2c/2E\'),e.H);$(\'.t .w .x .I\').7(\'X\',14[c].X+\'D\');$(\'.t .w .x .I\').W(\'<a 2d="25" E="\'+b+\'"\'+d+\' 1l=""><1F T="24\'+c+\'" 1o="\'+e+\'" 22="" 1l="" /></a>\');4(l){5.1D()}}L{4($(\'.t .w .x .I\').W()!=\'1m...\'){1B=$(\'.t .w .x .I\').W()}$(\'.t .w .x .I\').W(\'1m...\');4(q)r.s(\'1m 2c...\')}R 1p};5.1D=8(){4($(\'.t .w .x #Q\').H==0||$(\'.t .w .x #Q\').7(\'1b\')==\'1c\'){$(\'.t .w .x .I\').W($(\'.t .w .x .I\').W());4($(".I").H>0){$(".I").2F()}}};5.1E=8(){4(q)r.s(\'1E\');$(\'.16\').F(\'v\');$(\'.16\').G(\'v\',8(){4(q)r.s(\'.16 v\');4($(\'.t .w .x #Q\').H>0&&$(\'.t .w .x #Q\').7(\'1b\')!=\'1c\'){n.1d(5)}L{$(\'.2G\').2H(\'<1q T="1r"></1q>\');$(\'#1r\').7({2I:\'2J\',1s:\'2K\',1K:\'2L\',X:\'2b%\'});$(\'#1r\').2M(\'2N.2O?2P=3&T=\'+$("#2Q").o(\'2R\')+\'&2S=\'+2T,8(a){n.2e();n.2f()});4(2U.2V.2W(/2X [0-6]\\./)){$(\'.2Y\').7({17:\'1L\'})}1M.2Z(\'#1r\');$(\'#30\').7({1b:\'1c\'});4($(2g).12()>$(\'#2h\').12()){u b=$(2g).12()}L{u b=$(\'#2h\').12()+31}$(\'#32\').7({12:b+\'D\'})}R p})};5.2e=8(){4(q)r.s(\'t 1a\');u b=M($(\'#A\').7(\'12\').y(\'D\',\'\')),1N=0;4($(\'#A .18:2i\').H>0){1N=M($(\'#A .18:2i\').7(\'12\').y(\'D\',\'\'))}u c=1O.2j(b/2)-1O.2j(1N/2);$(\'#A .18\').2k(\'<1q 1J="1P-1K:\'+c+\'D;2l:1s;" />\');$(\'#A .1t\').2k(\'<1q 1J="1P-1K:\'+c+\'D;2l:1u;" />\');$(\'#3\').F(\'1Q\');$(\'#3\').G(\'1Q\',8(){4(q)r.s(\'#3 1Q\');1j=p});$(\'#3\').F(\'1R\');$(\'#3\').G(\'1R\',8(){4(q)r.s(\'#3 1R\');1j=z});$(\'33\').v(8(){4(1j&&1g(34)==\'26\'){1M.2m()}});u d=0,1v=M($(\'#3 .9\').7(\'X\').y(\'D\',\'\'))+M($(\'#3 .9\').7(\'1P-1u\').y(\'D\',\'\'))+M($(\'#3 .9\').7(\'2n-1s\').y(\'D\',\'\'))+M($(\'#3 .9\').7(\'2n-1u\').y(\'D\',\'\'))+M($(\'#3 .9\').7(\'2o-1s-X\').y(\'D\',\'\'))+M($(\'#3 .9\').7(\'2o-1u-X\').y(\'D\',\'\')),1S=M($(\'#3\').7(\'X\').y(\'D\',\'\'));d=$(\'#3 .9\').H*1v;4(1S<d){u e=1O.35(1S/1v);d=e*1v}$(\'#1T\').7(\'X\',d+\'D\');u f=0,13=0;$(\'.t .36 .Z\').1w(8(){4($(5).o(\'2d\').10(\'1H\')!=-1){f=13}13++});$(\'#A\').7(\'N-O\',\'P(\'+$(\'#3 .9 a\').Y(f).o(\'E\')+\')\');$(\'#3 .9\').Y(f).U(\'K\');$(\'#3 .9 a\').F(\'v\');$(\'#3 .9 a\').G(\'v\',8(){4(q)r.s(\'#3 .9 a v\');$(\'#3 .9\').J(\'K\');$(5).1e().U(\'K\');u a=$(5).o(\'E\');$(\'#A\').7(\'N-O\',\'P(\'+a+\')\');n.1f(z);R p});$(\'#3 .B, #3 .B a\').2p(\'v\');$(\'#3 .B, #3 .B a\').v(8(){4(q)r.s(\'#3 .B, #3 .B a v\');u a=$(\'#A\').7(\'N-O\').y(\'P("\',\'\').y(\'")\',\'\'),1x=\'\',1U=37,19=p;$(\'#3 .9 a\').1w(8(){4(a.10($(5).o(\'E\'))!=-1){4(1x!=\'\'){$(\'#A\').7(\'N-O\',\'P(\'+1x+\')\');$(\'#3 .9\').J(\'K\');$(1U).1e().U(\'K\');19=z}}L{1x=$(5).o(\'E\');1U=5}});4(19==p){$(\'#A\').7(\'N-O\',\'P(\'+$(\'#3 .9 a\').Y($(\'#3 .9 a\').H-1).o(\'E\')+\')\');$(\'#3 .9\').J(\'K\');$(\'#3 .9 a\').Y($(\'#3 .9 a\').H-1).1e().U(\'K\')}n.1f(z);R p});$(\'#3 .C, #3 .C a\').2p(\'v\');$(\'#3 .C, #3 .C a\').v(8(){4(q)r.s(\'#3 .C, #3 .C a v\');u a=$(\'#A\').7(\'N-O\').y(\'P("\',\'\').y(\'")\',\'\'),1y=p,19=p;$(\'#3 .9 a\').1w(8(){4(1y==z){$(\'#A\').7(\'N-O\',\'P(\'+$(5).o(\'E\')+\')\');$(\'#3 .9\').J(\'K\');$(5).1e().U(\'K\');1y=p;19=z}4(a.10($(5).o(\'E\'))!=-1){1y=z}});4(19==p){$(\'#A\').7(\'N-O\',\'P(\'+$(\'#3 .9 a\').Y(0).o(\'E\')+\')\');$(\'#3 .9\').J(\'K\');$(\'#3 .9 a\').Y(0).1e().U(\'K\')}n.1f(z);R p});u g=p;$(\'#3 .B\').F(\'S\');$(\'#3 .B\').G(\'S\',8(){4(q)r.s(\'#3 .B S\');4(!g){$(\'.18\').U(\'1V\');$(\'.1t\').J(\'1W\')}});$(\'#3 .B\').F(\'V\');$(\'#3 .B\').G(\'V\',8(){4(q)r.s(\'#3 .B V\');$(\'.18\').J(\'1V\')});$(\'#3 .C\').F(\'S\');$(\'#3 .C\').G(\'S\',8(){4(q)r.s(\'#3 .C S\');g=z;$(\'.1t\').U(\'1W\');$(\'.18\').J(\'1V\')});$(\'#3 .C\').F(\'V\');$(\'#3 .C\').G(\'V\',8(){4(q)r.s(\'#3 .C V\');g=p;$(\'.1t\').J(\'1W\')});$(\'#3 .1X\').F(\'v\');$(\'#3 .1X\').G(\'v\',8(){4(q)r.s(\'#3 .1X v\');1M.2m();R p});n.1f(z)};5.1f=8(a){4(a==p){4($(\'#A\').7(\'N-O\').y(\'P("\',\'\').y(\'")\',\'\').10($(\'#3 .9 a\').Y(0).o(\'E\'))!=-1){$(\'#3 .B\').7(\'17\',\'1L\')}L{$(\'#3 .B\').7(\'17\',\'1Y\')}4($(\'#A\').7(\'N-O\').y(\'P("\',\'\').y(\'")\',\'\').10($(\'#3 .9 a\').Y($(\'#3 .9 a\').H-1).o(\'E\'))!=-1){$(\'#3 .C\').7(\'17\',\'1L\')}L{$(\'#3 .C\').7(\'17\',\'1Y\')}}L{4($(\'#1T .9\').H>1){$(\'#3 .B, #3 .C\').7(\'17\',\'1Y\')}L{$(\'#1T\').27()}}};5.2f=8(){u a=1i 38(),13=0;$(\'#3 .9 a\').1w(8(){a[13]=1i 28();a[13].1o=$(5).o(\'E\');13++})};5.1a()}',62,195,'|||lightbox_gallery|if|this||css|function|thumbnail|||||||||||||||attr|false|fb|console|log|gallery|var|click|inside|stage|replace|true|lightbox_gallery_main|lightbox_gallery_left|lightbox_gallery_right|px|href|die|live|length|info_image_box|removeClass|lightbox_thumbnail_active|else|Number|background|image|url|crossslide|return|mouseover|id|addClass|mouseout|html|width|eq|button_product_images|search|t_thumbnail_id|height|count_thumbnails|t_images_array|t_active_image_id|button_lightbox_gallery|visibility|icon_gallery_back|t_updated_image|init_binds|display|none|show_image|parent|update_navigation|typeof|t_interval|new|t_close_lightbox|t_wait|title|loading|show_image_after_delay|src|t_image_loaded|div|lightbox_gallery_box|left|icon_gallery_next|right|t_thumbnail_width|each|t_previous_image|t_current_image_reached|ButtonProductImagesHandler|t_timeout|t_last_image_html|bind_thumbnails|bind_zoom|bind_lightbox|img|gallery_inside_thumbnail_|active_thumbnail|load_image|style|top|hidden|gmLightBox|t_button_height|Math|margin|mouseenter|mouseleave|t_gallery_width|lightbox_gallery_thumbnails|t_previous_element|icon_gallery_back_active|icon_gallery_next_active|icon_lightbox_close|visible|boolean|parseInt|find|alt|clearInterval|gallery_inside_main_|jqzoom|undefined|hide|Image|t_load_image|rel|100|images|class|gallery_init_binds|preload|document|popup_box|first|round|wrap|float|close_box|padding|border|unbind|ready|500|NaN|Object|clearTimeout|setTimeout|closest|no|element|setInterval|complete|cursor|default|substring|product_images|zoom_plugin|wrap_shop|append|position|absolute|0px|60px|load|request_port|php|module|gm_products_id|value|XTCsid|gm_session_id|navigator|appVersion|match|MSIE|lightbox_visibility_hidden|load_box|menubox_gm_scroller|200|__dimScreen|body|gm_style_edit_mode_running|floor|thumbnails|null|Array'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function ButtonProductImagesHandler(p_lightbox, p_zoom, p_delay)
{
	if(fb)console.log('ButtonProductImagesHandler ready');

	var t_lightbox = true;
	if(typeof(p_lightbox) == 'boolean')
	{
		t_lightbox = p_lightbox;
	}
	var t_zoom = true;
	if(typeof(p_zoom) == 'boolean')
	{
		t_zoom = p_zoom;
	}
	var t_delay = 500;
	if(parseInt(p_delay) != 'NaN')
	{
		t_delay = parseInt(p_delay);
	}

	var coo_this = this;
	var t_interval = 0;
	var t_images_array = new Object();
	var t_close_lightbox = true;
	var t_wait = false;
	var t_timeout = 0;
	var t_active_image_id = '';
	var t_last_image_html = '';


	this.init_binds = function()
	{
		if(fb)console.log('ButtonProductImagesHandler init_binds');

		this.bind_thumbnails();
		if(t_zoom)
		{
			this.bind_zoom();
		}
		if(t_lightbox)
		{
			this.bind_lightbox();
		}
		else
		{
			$('.button_lightbox_gallery').die('click');
			$('.button_lightbox_gallery').live('click', function()
			{
				if(fb)console.log('.button_lightbox_gallery click');

				if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
				{
					coo_this.show_image(this);
				}

				return false;
			});
		}
	}


	this.bind_thumbnails = function()
	{
		if(fb)console.log('bind_thumbnails');

		var t_thumbnail_id = '';

		$('a.button_product_images').die('mouseover');
		$('a.button_product_images').live('mouseover', function()
		{
			if(fb)console.log('a.button_product_images mouseover: ' + $(this).attr('id'));

			$(this).attr('title', '');
			$(this).find('img').attr('title', '');
			$(this).find('img').attr('alt', '');

			if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
			{
				t_active_image_id = '#' + $(this).attr('id');

				if(t_wait == false)
				{
					coo_this.show_image(this);
				}

			}

			return false;
		});

		$('.button_product_images').die('mouseout');
		$('.button_product_images').live('mouseout', function()
		{
			clearInterval(t_interval);

			if($('.gallery .inside .stage .info_image_box').html() == 'loading...')
			{
				$('.gallery .inside .stage .info_image_box').html(t_last_image_html);
				coo_this.init_binds();
			}

			clearTimeout(t_timeout);
			t_active_image_id = '';
			t_wait = true;
			t_timeout = setTimeout(coo_this.show_image_after_delay, t_delay);

			t_thumbnail_id = $(this).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			$('.gallery .inside .stage #gallery_inside_main_' + t_thumbnail_id).closest('a').removeClass('jqzoom');


			return false;
		});
	}


	this.show_image_after_delay = function()
	{
		t_wait = false;

		if(t_active_image_id != '')
		{
			if(fb)console.log('show_image_after_delay(): ' + t_active_image_id);
			coo_this.show_image(t_active_image_id);
		}
		else
		{
			if(fb)console.log('show_image_after_delay(): no element');
		}
	}


	this.show_image = function(p_element)
	{
		if(typeof($(p_element).attr('id')) != 'undefined' && $(p_element).attr('id').search('gallery_inside_thumbnail_') != -1)
		{
			$('.gallery .inside .stage #crossslide').hide();

			$('a.button_product_images').removeClass('active_thumbnail');
			$(p_element).addClass('active_thumbnail');

			t_thumbnail_id = $(p_element).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			t_images_array[t_thumbnail_id] = new Image();

			t_images_array[t_thumbnail_id].src = $(p_element).attr('href');

			t_load_image = this.load_image(t_thumbnail_id, $(p_element).attr('rel'));

			if(t_load_image == false)
			{
				t_interval = setInterval(function(){coo_this.load_image(t_thumbnail_id, $(p_element).attr('rel'));}, 100);
			}
		}
	}


	this.load_image = function(p_id, p_zoom_url)
	{
		var c_id = Number(p_id);

		var t_image_loaded = true;
		if(t_images_array[c_id].complete != true)
		{
			t_image_loaded = false;
		}

		if(t_image_loaded)
		{
			clearInterval(t_interval);

			var t_style = '';
			if(t_lightbox == false)
			{
				t_style = ' style="cursor: default;"';
			}

			// create relative image path, to avoid problems with umlaut domains
			var t_image_url = t_images_array[c_id].src;
			t_image_url = t_image_url.substring(t_image_url.search('images/product_images'), t_image_url.length);

			$('.gallery .inside .stage .info_image_box').css('width', t_images_array[c_id].width + 'px');
			$('.gallery .inside .stage .info_image_box').html('<a class="jqzoom" href="' + p_zoom_url + '"' + t_style + ' title=""><img id="gallery_inside_main_' + c_id + '" src="' + t_image_url + '" alt="" title="" /></a>');

			if(t_zoom)
			{
				this.bind_zoom();
			}
		}
		else
		{
			if($('.gallery .inside .stage .info_image_box').html() != 'loading...')
			{
				t_last_image_html = $('.gallery .inside .stage .info_image_box').html();
			}
			$('.gallery .inside .stage .info_image_box').html('loading...');
			if(fb)console.log('loading images...');
		}

		return t_image_loaded;
	}


	this.bind_zoom = function()
	{
    
		if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
		{
			// workaround for chrome browser
			$('.gallery .inside .stage .info_image_box').html($('.gallery .inside .stage .info_image_box').html());

			if($(".info_image_box").length > 0)
			{
				$(".info_image_box").zoom_plugin();
			}
		}
	}


	this.bind_lightbox = function()
	{
		if(fb)console.log('bind_lightbox');

		$('.button_lightbox_gallery').die('click');
		$('.button_lightbox_gallery').live('click', function()
		{
			if(fb)console.log('.button_lightbox_gallery click');

			if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
			{
				coo_this.show_image(this);
			}
			else
			{
				$('.wrap_shop').append('<div id="lightbox_gallery_box"></div>');

				$('#lightbox_gallery_box').css(
				{
					position: 	'absolute',
					left: 			'0px',
					top: 				'60px',
					width: 			'100%'
				});

				$('#lightbox_gallery_box').load('request_port.php?module=lightbox_gallery&id=' + $("#gm_products_id").attr('value') + '&XTCsid=' + gm_session_id,
					function(lightbox_gallery)
					{
						coo_this.gallery_init_binds();
						coo_this.preload();
					}
				);

				if (navigator.appVersion.match(/MSIE [0-6]\./)) {
					$('.lightbox_visibility_hidden').css(
					{
						visibility: 	'hidden'
					});
				}

				gmLightBox.load_box('#lightbox_gallery_box');
				// BOF MOD by PT
				$('#menubox_gm_scroller').css({
					display: 'none'
				});

				if($(document).height() > $('#popup_box').height()) {
					var pt_height = $(document).height();
				} else {
					var pt_height = $('#popup_box').height() + 200;
				}
				$('#__dimScreen').css({height: pt_height + 'px'});
				// EOF MOD by PT
			}

			return false;
		});
	}

	this.gallery_init_binds = function()
	{
		if(fb)console.log('gallery init_binds');

		var t_main_height = Number($('#lightbox_gallery_main').css('height').replace('px', ''));
		var t_button_height = 0;
		if($('#lightbox_gallery_main .icon_gallery_back:first').length > 0)
		{
			t_button_height = Number($('#lightbox_gallery_main .icon_gallery_back:first').css('height').replace('px', ''));
		}
		var t_margin_top = Math.round(t_main_height / 2) - Math.round(t_button_height / 2);

		$('#lightbox_gallery_main .icon_gallery_back').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:left;" />');
		$('#lightbox_gallery_main .icon_gallery_next').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:right;" />');

		$('#lightbox_gallery').die('mouseenter');
		$('#lightbox_gallery').live('mouseenter', function()
		{
			if(fb)console.log('#lightbox_gallery mouseenter');

			t_close_lightbox = false;
		});

		$('#lightbox_gallery').die('mouseleave');
		$('#lightbox_gallery').live('mouseleave', function()
		{
			if(fb)console.log('#lightbox_gallery mouseleave');

			t_close_lightbox = true;
		});

		$('body').click(function()
		{
			if(t_close_lightbox && typeof(gm_style_edit_mode_running) == 'undefined')
			{
				gmLightBox.close_box();
			}
		});

		// centering thumbnails
		var t_thumbnails_width = 0;
		var t_thumbnail_width = Number($('#lightbox_gallery .thumbnail').css('width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('margin-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-left').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-left-width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-right-width').replace('px', ''));
		var t_gallery_width = Number($('#lightbox_gallery').css('width').replace('px', ''));
		t_thumbnails_width = $('#lightbox_gallery .thumbnail').length * t_thumbnail_width;
		if(t_gallery_width < t_thumbnails_width)
		{
			var t_thumbnails_per_row = Math.floor(t_gallery_width / t_thumbnail_width);
			t_thumbnails_width = t_thumbnails_per_row * t_thumbnail_width;
		}
		$('#lightbox_gallery_thumbnails').css('width', t_thumbnails_width + 'px');

		var t_active_image = 0;
		var count_thumbnails = 0;
		$('.gallery .thumbnails .button_product_images').each(function()
		{
			if($(this).attr('class').search('active_thumbnail') != -1)
			{
				t_active_image = count_thumbnails;
			}

			count_thumbnails++;
		});

		$('#lightbox_gallery_main').css('background-image', 'url(' + $('#lightbox_gallery .thumbnail a').eq(t_active_image).attr('href') + ')');
		$('#lightbox_gallery .thumbnail').eq(t_active_image).addClass('lightbox_thumbnail_active');

		$('#lightbox_gallery .thumbnail a').die('click');
		$('#lightbox_gallery .thumbnail a').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .thumbnail a click');

			$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
			$(this).parent().addClass('lightbox_thumbnail_active');

			var t_popup_image_url = $(this).attr('href');
			$('#lightbox_gallery_main').css('background-image', 'url(' + t_popup_image_url + ')');

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a click');

			var t_current_image = $('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '');
			var t_previous_image = '';
			var t_previous_element = null;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				if(t_current_image.search($(this).attr('href')) != -1)
				{
					if(t_previous_image != '')
					{
						$('#lightbox_gallery_main').css('background-image', 'url(' + t_previous_image + ')');

						$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
						$(t_previous_element).parent().addClass('lightbox_thumbnail_active');

						t_updated_image = true;
					}
				}
				else
				{
					t_previous_image = $(this).attr('href');
					t_previous_element = this;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url(' + $('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).attr('href') + ')');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a click');

			var t_current_image = $('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '');
			var t_current_image_reached = false;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				if(t_current_image_reached == true)
				{
					$('#lightbox_gallery_main').css('background-image', 'url(' + $(this).attr('href') + ')');

					$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
					$(this).parent().addClass('lightbox_thumbnail_active');

					t_current_image_reached = false;
					t_updated_image = true;
				}

				if(t_current_image.search($(this).attr('href')) != -1)
				{
					t_current_image_reached = true;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url(' + $('#lightbox_gallery .thumbnail a').eq(0).attr('href') + ')');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq(0).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		var t_right_mouseover = false;

		// BOF previous image
		$('#lightbox_gallery .lightbox_gallery_left').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseover');

			if(!t_right_mouseover)
			{
				$('.icon_gallery_back').addClass('icon_gallery_back_active');
				$('.icon_gallery_next').removeClass('icon_gallery_next_active');
			}
		});

		$('#lightbox_gallery .lightbox_gallery_left').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseout');

			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});
		// EOF previous image

		// BOF next image
		$('#lightbox_gallery .lightbox_gallery_right').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseover');

			t_right_mouseover = true;

			$('.icon_gallery_next').addClass('icon_gallery_next_active');
			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});

		$('#lightbox_gallery .lightbox_gallery_right').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseout');

			t_right_mouseover = false;

			$('.icon_gallery_next').removeClass('icon_gallery_next_active');
		});
		// EOF next image

		// BOF close
		$('#lightbox_gallery .icon_lightbox_close').die('click');
		$('#lightbox_gallery .icon_lightbox_close').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .icon_lightbox_close click');

			gmLightBox.close_box();

			return false;
		});
		// EOF close

		coo_this.update_navigation(true);
	}


	this.update_navigation = function(p_loop)
	{
		if(p_loop == false)
		{
			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq(0).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'visible');
			}

			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length-1).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
		}
		else
		{
			if($('#lightbox_gallery_thumbnails .thumbnail').length > 1)
			{
				$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
			else
			{
				$('#lightbox_gallery_thumbnails').hide();
			}
		}
	}

	this.preload = function()
	{
		var t_images = new Array();
		var count_thumbnails = 0;

		$('#lightbox_gallery .thumbnail a').each(function()
		{
			t_images[count_thumbnails] = new Image();
			t_images[count_thumbnails].src = $(this).attr('href');

			count_thumbnails++;
		});
	}

	this.init_binds();
}
/*<?php
}
?>*/
